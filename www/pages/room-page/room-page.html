<ion-view id="roomPage" view-title="{{vm.pageTitle}}">
  <ion-nav-buttons side="left">
    <button class="button" ng-click="vm.returnToRooms()">
      Back to rooms
    </button>

    <button class="button" ng-click="vm.chatOn = !vm.chatOn; vm.unreadMessages = 0;" style="margin-left: 2px">
      Chat {{vm.unreadMessages > 0 ? "(" + vm.unreadMessages + ")" : ""}}
    </button>
  </ion-nav-buttons>

  <!--PAGE CONTENT-->
  <ion-content>

    <!--CHAT DIV-->
    <div class="chat-div" ng-show="vm.chatOn">
      <div style="text-align: right">
        <span ng-click="vm.chatOn = false;">X</span>
      </div>
      <div>
        <div ng-repeat="message in vm.messages">

          <div class="row" ng-bind-html="vm.getMessageText(message)">

          </div>

        </div>
      </div>

      <div class="row">
        <input class="col-75" ng-model="vm.messageContent">
        <button class="col-25 button button-positive" style="margin: 2px;" ng-click="vm.sendMessage()">
          Send
        </button>
      </div>
    </div>

    <div class="game-div">

      <ion-list>

        <!--LIST ITEM-->
        <ion-item class="item-avatar item-icon-right vertical-center user-item"
                  ng-repeat="user in vm.users | orderBy: 'key'"
                  ng-class="{'current-user-turn': user.currentUser, 'not-current-user-turn': !user.currentUser, 'disabled-player': !user.isLoggedIn}">

          <div class="row">

            <!--USER NAME-->
            <div class="col" ng-class="{'col-40': !vm.showUsersCubes, 'col-20': vm.showUsersCubes}">
              <h2 ng-class="{'foo': user.currentUser}" ng-show="!user.isMe">
                {{user.name}} ({{user.currentNumOfCubes ? user.currentNumOfCubes : 'Off'}})
              </h2>
              <h2 ng-class="{'foo': user.currentUser}" ng-show="user.isMe" style="font-weight: 900">
                Me
              </h2>
            </div>

            <!--GAMBLING DETAILS-->
            <div class="col col-60"
                 ng-show="!vm.showUsersCubes && user.gambleTimes != null && user.gambleCube != null">
              <label ng-class="{'last-player-turn': user.lastUser}" ng-show="user.id != vm.room.currentUserTurnId">
                Gamble:
                {{user.gambleTimes}}
                Times of
                {{user.gambleCube}}
              </label>
            </div>

            <!--SHOW USER CUBES AFTER ROUND FINISHED-->
            <div class="col-80" ng-show="vm.showUsersCubes" style="display: flex;">
            <span ng-repeat="cube in user.cubes" style="align-self: center">
              <img class="user-cube"
                   ng-class="{'gambled-cube': cube.cubeNum == vm.room.lastGambleCube || cube.cubeNum == 1}"
                   ng-src="{{vm.getCubeImage(cube.cubeNum)}}"/>
            </span>
            </div>
          </div>
        </ion-item>

        <!--END ROUND RESULT-->
        <ion-item ng-if="vm.showUsersCubes && vm.endRoundResult" style="padding: 0 !important;">
          <div style="text-align: center;padding: 20px;">
          <span style="color: #326fab;margin-left: 12px;" ng-bind-html="vm.getEndRoundTextResult()">
          </span>
          </div>
        </ion-item>

      </ion-list>

      <!--if no players in the room-->
      <div
        style="bottom: 0; width: 100%; background-color: #0c60ee;text-align: center; position: absolute;padding: 20px 0;color: white;font-size: 15px"
        ng-show="!vm.showUsersCubes && vm.users.length < 2">
        The are no players in the room
      </div>

      <!--FOOTER - cubes and gambling stuff -->
      <div style="bottom: 0; width: 100%; background-color: #0c60ee;text-align: center; position: absolute"
           ng-show="!vm.showUsersCubes && vm.users.length > 1">

        <!--USER CUBES-->
        <span ng-repeat="cube in vm.myPlayer.cubes">
        <img style="height: 40px; width: 40px; margin: 5px" ng-src="{{vm.getCubeImage(cube.cubeNum)}}"/>
      </span>
        <br/>

        <!--GAMBLING-->
        <div ng-show="vm.isMyTurn && vm.showUserPanel" class="row vertical-center no-padding">

          <!--GAMBLE TIMES-->
          <div class="col col-20" style="color: white; font-size: 20px">
            <div class="col" ng-click="vm.increaseTimes()">
              <i class="ion-chevron-up"></i>
            </div>
            {{vm.getGambleTimes()}}
            <div class="col" ng-click="vm.decreaseTimes()" ng-class="{'opacity-05': !vm.canDecreaseTimes()}">
              <i class="ion-chevron-down"></i>
            </div>
          </div>

          <!--JUST TEXT-->
          <div class="col col-20" style="color: white; font-size: 20px">
            Times of
          </div>

          <!--GAMBLE CUBE-->
          <div class="col col-20" style="color: white; font-size: 20px">
            <div class="col" ng-click="vm.increaseCube()">
              <i class="ion-chevron-up"></i>
            </div>
            {{vm.getGambleCube()}}
            <div class="col" ng-click="vm.decreaseCube()" ng-class="{'opacity-05': !vm.canDecreaseCube()}">
              <i class="ion-chevron-down"></i>
            </div>
          </div>

          <!--SEND GAMBLE BUTTON-->
          <button class="col col-34 button button-balanced"
                  ng-click="vm.setGamble(vm.gambleTimes, vm.gambleCube, false)">
            Send gamble
          </button>
        </div>

        <!--LYING BUTTON-->
        <button
          ng-show="vm.isMyTurn && vm.room.lastGambleCube != null && vm.room.lastGambleTimes != null && vm.showUserPanel"
          style="margin: 10px"
          class="button button-assertive no-padding"
          ng-click="vm.setGamble(null, null, true)">
          It's a lie!
        </button>

        <!--REFRESH FOR DEBUG!!-->
        <button ng-show="vm.showRestartButton" style="    margin: 5px;
    position: absolute;
    bottom: 0;
    left: 0;" class="button button-energized no-padding" ng-click="vm.restartGame()">
          Restart
        </button>

      </div>
    </div>
  </ion-content>
</ion-view>
